# 週次敗血症エビデンス抽出機能 - 実装ガイド

## 実装概要

PubMed論文検索・分析パイプラインに、敗血症に関連する臨床的クエスチョン（CQ）に対するエビデンス論文を週次で抽出する機能を追加します。

## 追加機能の詳細

1. **週次エビデンス抽出**:
   - 毎週月曜日の12時に実行
   - 過去1週間分の分析済み論文からCQに関連するエビデンスを抽出
   - 結果をJSON形式で保存（関連論文がある場合のみ）

2. **対象となるCQ**:
   - CQ4-1: 敗血症に対して，PMX-DHPを行うか?
   - CQ4-2: 敗血症性AKIに対して，早期の腎代替療法を行うか?
   - CQ4-3: 敗血症性AKIに対する腎代替療法では持続的治療を行うか?
   - CQ4-4: 敗血症性AKIに対する腎代替療法において，血液浄化量の増加を行うか?

## 実装手順

### 1. ディレクトリとファイルの作成

```bash
# Lambda関数用のディレクトリを作成
mkdir -p weekly_evidence_lambda
```

### 2. Lambda関数の実装

`weekly_evidence_lambda/weekly_evidence_function.py` ファイルを作成し、週次エビデンス抽出ロジックを実装します。

### 3. CDKスタックの更新

`pubmed_search/pubmed_search_stack.py` ファイルを更新し、週次エビデンス抽出用のLambda関数とEventBridgeルールを追加します。

### 4. デプロイ

```bash
# CDKのデプロイ
cdk deploy
```

## アーキテクチャ

```
┌─────────────┐
│ EventBridge │
│ (毎週月曜日) │
└─────┬───────┘
      │
      ▼
┌─────────────┐    ┌─────────────┐
│  週次エビデンス │    │             │
│  抽出Lambda   │───▶│    S3       │
└─────────────┘    │  Bucket     │
                   └─────────────┘
```

## 出力ファイル形式

生成されるJSONファイルの構造:

```json
{
  "metadata": {
    "generated_date": "2025-03-19T12:00:00Z",
    "period_start": "2025-03-12",
    "period_end": "2025-03-19",
    "files_analyzed": 7,
    "articles_analyzed": 21
  },
  "evidence_articles": {
    "CQ4-1": [
      {
        "pmid": "12345678",
        "title": "論文タイトル",
        "summary": "論文の簡潔な要約",
        "evidence_value": "この論文がCQに対するエビデンスとしての価値についての説明"
      }
    ],
    "CQ4-2": [],
    "CQ4-3": [...],
    "CQ4-4": [...]
  }
}
```

## 注意点

1. CQに関連するキーワードはLambda関数内に定義されています。必要に応じて調整してください。
2. 関連するエビデンス論文がない場合、ファイルは作成されません。
3. Lambda関数のタイムアウトは300秒（5分）に設定されていますが、処理するファイル数が多い場合は増やす必要があるかもしれません。
